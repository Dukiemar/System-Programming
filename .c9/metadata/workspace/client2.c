{"changed":false,"filter":false,"title":"client2.c","tooltip":"/client2.c","undoManager":{"mark":12,"position":12,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":139,"column":1},"action":"insert","lines":["#include <stdio.h>","#include <sys/types.h>","#include <sys/socket.h>","#include <netinet/in.h>","#include <stdlib.h>","#include <string.h>","","#define BUF_SIZE\t1024","#define\tSERVER_IP\t\"127.0.0.1\"","#define SERVER_PORT\t60000","#define PEER_PORT\t50000","//#define PEER_IP","void serve();","","    int \t            sock_listen,sock_recv;","    struct sockaddr_in\t    my_addr,recv_addr;","    int               \t    y,addr_size,bytes_received;","    fd_set                  readfds;","    //struct timeval\t    timeout={0,0};","    int\t                    incoming_len;","    struct sockaddr\t    remote_addr;","    int\t                    recv_msg_size;","    char                    buf[BUF_SIZE];","    int\t                    select_ret;","","int main(int argc, char *argv[]){","    int\tsock_send;","    struct sockaddr_in\taddr_send,addr2_send;","    int\ti,x,n;","    char text[80],buf[BUF_SIZE],IP[20];","    int\tsend_len,bytes_sent;","","","    sock_send=socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);","    if (sock_send < 0){","        printf(\"error...socket failed\\n\");","        exit(0);","    }","","","    memset(&addr_send, 0, sizeof (addr_send));","    addr_send.sin_family = AF_INET; ","    addr_send.sin_addr.s_addr = inet_addr(SERVER_IP);","    addr_send.sin_port = htons((unsigned short)SERVER_PORT);","    ","/*","","    memset(&addr2_send, 0, sizeof (addr2_send));","    addr2_send.sin_family = AF_INET; ","    addr2_send.sin_addr.s_addr = inet_addr(IP);","    addr2_send.sin_port = htons((unsigned short)PEER_PORT);","    ","     x=connect(sock_send, (struct sockaddr *) &addr_send, sizeof (addr_send));","    if (x < 0){","        printf(\"error...connection failed\\n\");","        exit(0);","    }","","  */  ","    i=connect(sock_send, (struct sockaddr *) &addr_send, sizeof (addr_send));","    if (i < 0){","        printf(\"error...connection failed\\n\");","        exit(0);","    }","","    while (1){","\t    //serve();","","        printf(\"Enter message to send: \");","        scanf(\"%s\",text);","        if (strcmp(text,\"Exit\") == 0)","            break;","","        strcpy(buf,text);","        send_len=strlen(text);","        bytes_sent=send(sock_send,buf,send_len,0);","\t","\tbzero(buf,1024);","\tn = read(sock_send,buf,1024);","\tif (n < 0) ","         printf(\"ERROR reading from socket\");","\tprintf(\"%s\\n\",buf);","","\t","    }","","    close(sock_send);","}","","void serve()","{","   /* int \t            sock_listen,sock_recv;","    struct sockaddr_in\t    my_addr,recv_addr;","    int               \t    i,addr_size,bytes_received;","    fd_set                  readfds;","    struct timeval\t    timeout={0,0};","    int\t                    incoming_len;","    struct sockaddr\t    remote_addr;","    int\t                    recv_msg_size;","    char                    buf[BUF_SIZE];","    int\t                    select_ret;","*/","    sock_listen=socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);","    if (sock_listen < 0){","        printf(\"error...socket failed\\n\");","        exit(0);","    }","    memset(&my_addr, 0, sizeof (my_addr));\t","    my_addr.sin_family = AF_INET;\t","    my_addr.sin_addr.s_addr = htonl(INADDR_ANY);  ","    my_addr.sin_port = htons((unsigned short)PEER_PORT);","        ","    y=bind(sock_listen, (struct sockaddr *) &my_addr, sizeof (my_addr));","    if (y < 0){","        printf(\"error...bind failed\\n\");","        exit(0);","    }","    ","    y=listen(sock_listen, 5);","    if (y < 0)","    {","        printf(\"error... listen failed\\n\");","        exit(0);","    }","","        ","    addr_size=sizeof(recv_addr);","    sock_recv=accept(sock_listen, (struct sockaddr *) &recv_addr, &addr_size);","","    while (1){","        bytes_received=recv(sock_recv,buf,BUF_SIZE,0);","        buf[bytes_received]=0;","        printf(\"Received: %s\\n\",buf);","    if (strcmp(buf,\"Finish\") == 0)","        break;","    }","","    close(sock_recv);","    close(sock_listen);","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":66,"column":6},"end":{"row":66,"column":7},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":66,"column":5},"end":{"row":66,"column":6},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":66,"column":5},"end":{"row":66,"column":6},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":66,"column":6},"end":{"row":66,"column":7},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":0},"end":{"row":64,"column":8},"action":"insert","lines":["serve();"]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":0},"end":{"row":64,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":4},"end":{"row":64,"column":12},"action":"remove","lines":["serve();"]}]}],[{"group":"doc","deltas":[{"start":{"row":84,"column":5},"end":{"row":85,"column":0},"action":"insert","lines":["",""]},{"start":{"row":85,"column":0},"end":{"row":85,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":21},"end":{"row":88,"column":0},"action":"insert","lines":["",""]},{"start":{"row":88,"column":0},"end":{"row":88,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":4},"end":{"row":88,"column":12},"action":"insert","lines":["serve();"]}]}],[{"group":"doc","deltas":[{"start":{"row":88,"column":4},"end":{"row":88,"column":12},"action":"remove","lines":["serve();"]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":4},"end":{"row":64,"column":12},"action":"insert","lines":["serve();"]}]}]]},"ace":{"folds":[],"scrolltop":1380,"scrollleft":0,"selection":{"start":{"row":8,"column":27},"end":{"row":8,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":97,"state":"comment","mode":"ace/mode/c_cpp"}},"timestamp":1428909282000}