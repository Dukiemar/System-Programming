{"filter":false,"title":"client2.1.c","tooltip":"/client2.1.c","undoManager":{"mark":5,"position":5,"stack":[[{"group":"doc","deltas":[{"start":{"row":104,"column":4},"end":{"row":141,"column":1},"action":"remove","lines":["sock_listen=socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);","    if (sock_listen < 0){","        printf(\"error...socket failed\\n\");","        exit(0);","    }","    memset(&my_addr, 0, sizeof (my_addr));\t","    my_addr.sin_family = AF_INET;\t","    my_addr.sin_addr.s_addr = htonl(INADDR_ANY);  ","    my_addr.sin_port = htons((unsigned short)PEER_PORT);","        ","    y=bind(sock_listen, (struct sockaddr *) &my_addr, sizeof (my_addr));","    if (y < 0){","        printf(\"error...bind failed\\n\");","        exit(0);","    }","    ","    y=listen(sock_listen, 5);","    if (y < 0)","    {","        printf(\"error... listen failed\\n\");","        exit(0);","    }","","        ","    addr_size=sizeof(recv_addr);","    sock_recv=accept(sock_listen, (struct sockaddr *) &recv_addr, &addr_size);","","    while (1){","        bytes_received=recv(sock_recv,buf,BUF_SIZE,0);","        buf[bytes_received]=0;","        printf(\"Received: %s\\n\",buf);","    if (strcmp(buf,\"Finish\") == 0)","        break;","    }","","    close(sock_recv);","    close(sock_listen);","}"]},{"start":{"row":104,"column":4},"end":{"row":186,"column":1},"action":"insert","lines":["sock_listen=socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);","    if (sock_listen < 0){","        printf(\"error...socket() failed\\n\");","        exit(0);","    }","        /* make local address structure */","    memset(&my_addr, 0, sizeof (my_addr));\t/* zero out structure */","    my_addr.sin_family = AF_INET;\t/* address family */","    my_addr.sin_addr.s_addr = htonl(INADDR_ANY);  /* current machine IP */","    my_addr.sin_port = htons((unsigned short)LISTEN_PORT);","        /* bind socket to the local address */","    i=bind(sock_listen, (struct sockaddr *) &my_addr, sizeof (my_addr));","    if (i < 0){","        printf(\"error...bind() failed\\n\");","        exit(0);","    }","        /* listen ... */","    listen(sock_listen, 5);","    addr_size=sizeof(recv_addr);","    ","        /* get new socket to receive data on */","\twhile(1){","\tsock_recv=accept(sock_listen, (struct sockaddr *) &recv_addr, &addr_size);","       // bytes_received=recv(sock_recv,buf,BUF_SIZE,0);","        //buf[bytes_received]=0;","\t","\tif (sock_recv < 0)","        printf(\"error...listen() failed\\n\");","        //exit(0);","","        pid=fork();","\tif (pid<0)","\t   printf(\"error...fork() failed\\n\");","\tif (pid == 0)  {","           close(sock_listen);","\t   ","\t   //client_list[0]=inet_ntoa(recv_addr);","\t   //printf( \" client %s\\n\",client_list[0]);","           func(sock_recv);","\t       exit(0);","    }","\telse close(sock_recv);","   }","   close(sock_listen);","   return 0;","}","","/*void func (int sock)","{","   int x;","   char buffer[1024];","   while(1){","     ","   bzero(buffer,1024);","   x = read(sock,buffer,1024);","   if (x < 0)","     printf(\"Client %s communication has been disconnect\\n\",inet_ntoa(recv_addr));","   printf(\"Message received from %s: %s\\n\",inet_ntoa(recv_addr),buffer);","  // clients();","   x = write(sock,\"Message successfully received\\n\",29);","   if (x < 0) ","     printf(\"error...failed to write to socket\");","     ","  }","*/","void func(int sock)","{","   int x;","   char buffer[1024];","   while(1){","     ","   bzero(buffer,1024);","   x = read(sock,buffer,1024);","   if (x < 0)","     printf(\"Client communication has been disconnect\");","   printf(\"Message received: %s\\n\",buffer);","   x = write(sock,\"I got your message\",18);","   if (x < 0) ","     printf(\"error...failed to write to socket\");","     ","  }","  ","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":151,"column":0},"end":{"row":168,"column":2},"action":"remove","lines":["/*void func (int sock)","{","   int x;","   char buffer[1024];","   while(1){","     ","   bzero(buffer,1024);","   x = read(sock,buffer,1024);","   if (x < 0)","     printf(\"Client %s communication has been disconnect\\n\",inet_ntoa(recv_addr));","   printf(\"Message received from %s: %s\\n\",inet_ntoa(recv_addr),buffer);","  // clients();","   x = write(sock,\"Message successfully received\\n\",29);","   if (x < 0) ","     printf(\"error...failed to write to socket\");","     ","  }","*/"]}]}],[{"group":"doc","deltas":[{"start":{"row":93,"column":1},"end":{"row":103,"column":2},"action":"remove","lines":["  /* int \t            sock_listen,sock_recv;","    struct sockaddr_in\t    my_addr,recv_addr;","    int               \t    i,addr_size,bytes_received;","    fd_set                  readfds;","    struct timeval\t    timeout={0,0};","    int\t                    incoming_len;","    struct sockaddr\t    remote_addr;","    int\t                    recv_msg_size;","    char                    buf[BUF_SIZE];","    int\t                    select_ret;","*/"]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":4},"end":{"row":23,"column":39},"action":"remove","lines":["int \t            sock_listen,sock_recv;","    struct sockaddr_in\t    my_addr,recv_addr;","    int               \t    y,addr_size,bytes_received;","    fd_set                  readfds;","    //struct timeval\t    timeout={0,0};","    int\t                    incoming_len;","    struct sockaddr\t    remote_addr;","    int\t                    recv_msg_size;","    char                    buf[BUF_SIZE];","    int\t                    select_ret;"]},{"start":{"row":14,"column":4},"end":{"row":23,"column":19},"action":"insert","lines":[" int\tsock_listen,sock_recv;","    //struct sockaddr_in\tmy_addr,recv_addr;","    int i,addr_size,bytes_received,pid;","    fd_set readfds;","    //struct timeval\ttimeout={0,0};","    int\tincoming_len;","    //struct sockaddr\tremote_addr;","    //int\trecv_msg_size;","    //char buf[BUF_SIZE];","    int\tselect_ret;"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":13},"end":{"row":13,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":0},"end":{"row":14,"column":37},"action":"insert","lines":["struct sockaddr\tremote_addr;","struct sockaddr_in\tmy_addr,recv_addr;"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":14,"column":37},"end":{"row":14,"column":37},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1428910158961,"hash":"51bc1d8f1269934cb8bedb5ecb05e49240f72fec"}